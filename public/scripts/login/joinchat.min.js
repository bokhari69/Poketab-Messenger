import{check,errlog}from"./common.min.js";const socket=io("/auth");socket.on("connect",()=>{console.log("%cConnected to auth namespace","color: deepskyblue;")});const form=document.getElementById("form"),next=document.getElementById("next"),form1=document.getElementById("subform1"),form2=document.getElementById("subform2");export const hashes=[];const keyformat=/^[a-zA-Z0-9]{3}-[a-zA-Z0-9]{3}-[a-zA-Z0-9]{3}-[a-zA-Z0-9]{3}$/;function validateKey(){const key=document.getElementById("key").value;return 0==key.length?(document.getElementById("key").focus(),errlog("keyErr",'Key is required <i class="fa-solid fa-triangle-exclamation"></i>'),document.getElementById("keyLabel").innerHTML="Enter key <i id='lb__icon' class=\"fa-solid fa-key\"></i>",!1):!!keyformat.test(key)||(document.getElementById("key").focus(),errlog("keyErr",'Key is not valid <i class="fa-solid fa-triangle-exclamation"></i>'),document.getElementById("keyLabel").innerHTML="Enter key <i id='lb__icon' class=\"fa-solid fa-key\"></i>",!1)}form.addEventListener("submit",async e=>{e.preventDefault(),validateKey()&&await check(hashes)&&form.submit()});const keyElem=document.getElementById("key");function emitSignal(){const key=document.getElementById("key").value;socket.emit("joinRequest",key,response=>{if(document.getElementById("keyLabel").innerHTML="Enter key <i id='lb__icon' class=\"fa-solid fa-key\"></i>",response.success){const usersData=response.message;usersData.forEach(userData=>{const avatar=document.getElementById(userData.avatar);avatar.closest(".avatar").querySelector("img").classList.add("taken"),avatar.remove(),hashes.push(userData.hash)}),form1.classList.add("done"),form2.classList.add("active")}else errlog("keyErr",`${response.message} <i class="fa-solid fa-ghost"></i>`)})}["paste","keydown"].forEach(event=>{keyElem.addEventListener(event,e=>{"Enter"===e.key&&(e.preventDefault(),next.click()),"paste"===e.type&&setTimeout(()=>{next.click()},100)})}),next.addEventListener("click",e=>{e.preventDefault(),document.getElementById("keyLabel").innerHTML="Checking <i id='lb__icon' class=\"fa-solid fa-circle-notch fa-spin\"></i>",validateKey()&&emitSignal()}),window.autoFetch&&emitSignal(),console.log("%cjoinchat.js loaded","color: limegreen;");